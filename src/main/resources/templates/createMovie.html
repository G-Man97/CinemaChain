<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Добавить фильм</title>
    <link rel="stylesheet" type="text/css" href="/css/admin.css">
</head>
<body>
<div id="content">

    <h2>Добавить фильм</h2>

    <form action="/admin/movie" enctype="multipart/form-data" method="post">

        <input type="hidden" name="isItInRent" value="false">

        <div class="field">
            <div>
                <label for="title">Название фильма:
                    <input type="text" name="title" id="title" th:value="${movie.title}">
                </label>
            </div>
            <th:block th:if="${errors}">
                <div th:if="${errors.hasFieldErrors('title')}">
                    <ul class="error">
                        <li th:each="error : ${errors.getFieldErrors('title')}"
                            th:text="${error.getDefaultMessage()}"></li>
                    </ul>
                </div>
            </th:block>
        </div>
        <div class="field">
            <div>
                <label for="premiere">Премьера:
                    <input type="date" name="premiere" id="premiere" th:value="${movie.premiere}">
                </label>
            </div>
            <th:block th:if="${errors}">
                <div th:if="${errors.hasFieldErrors('premiere')}">
                    <ul class="error">
                        <li th:each="error : ${errors.getFieldErrors('premiere')}"
                            th:text="${error.getDefaultMessage()}"></li>
                    </ul>
                </div>
            </th:block>
        </div>
        <div class="field">
            <div>
                <label for="rentEnd">В прокате до:
                    <input type="date" name="rentEnd" id="rentEnd" th:value="${movie.rentEnd}">
                </label>
            </div>
            <th:block th:if="${errors}">
                <div th:if="${errors.hasFieldErrors('rentEnd') or errors.hasGlobalErrors()}">
                    <ul class="error">

                        <li th:each="error : ${errors.getFieldErrors('rentEnd')}"
                            th:text="${error.getDefaultMessage()}"></li>

                        <li th:each="global : ${errors.getGlobalErrors()}"
                            th:text="${global.getDefaultMessage()}"></li>
                    </ul>
                </div>
            </th:block>
        </div>
        <div class="field">
            <div>
                <label for="duration">Длительность:
                    <input type="text" name="duration" id="duration" th:value="${movie.duration}">
                </label>
            </div>
            <th:block th:if="${errors}">
                <div th:if="${errors.hasFieldErrors('duration')}">
                    <ul class="error">
                        <li th:each="error : ${errors.getFieldErrors('duration')}"
                            th:text="${error.getDefaultMessage()}"></li>
                    </ul>
                </div>
            </th:block>
        </div>
        <div class="field">
            <div>
                <label for="pegi">Возрастное ограничение:
                    <select name="pegi" id="pegi">
                        <option hidden selected value=""></option>
                        <option th:each="pegi : ${pegis}"
                                th:text="${pegi.value}"
                                th:selected="${pegi == movie.pegi}"
                                th:value="${pegi}">Pegi
                        </option>
                    </select>
                </label>
            </div>
            <th:block th:if="${errors}">
                <div th:if="${errors.hasFieldErrors('pegi')}">
                    <ul class="error">
                        <li th:each="error : ${errors.getFieldErrors('pegi')}"
                            th:text="${error.getDefaultMessage()}"></li>
                    </ul>
                </div>
            </th:block>
        </div>
        <div class="field">
            <div>
                <label for="genre">Жанр:
                    <input type="text" name="genre" id="genre" th:value="${movie.genre}">
                </label>
            </div>
            <th:block th:if="${errors}">
                <div th:if="${errors.hasFieldErrors('genre')}">
                    <ul class="error">
                        <li th:each="error : ${errors.getFieldErrors('genre')}"
                            th:text="${error.getDefaultMessage()}"></li>
                    </ul>
                </div>
            </th:block>
        </div>
        <div class="field">
            <div>
                <label for="countries">Страна(-ы):
                    <input type="text" name="countries" id="countries" th:value="${movie.countries}">
                </label>
            </div>
            <th:block th:if="${errors}">
                <div th:if="${errors.hasFieldErrors('countries')}">
                    <ul class="error">
                        <li th:each="error : ${errors.getFieldErrors('countries')}"
                            th:text="${error.getDefaultMessage()}"></li>
                    </ul>
                </div>
            </th:block>
        </div>
        <div class="field">
            <div>
                <label for="composer">Композитор:
                    <input type="text" name="composer" id="composer" th:value="${movie.composer}">
                </label>
            </div>
            <th:block th:if="${errors}">
                <div th:if="${errors.hasFieldErrors('composer')}">
                    <ul class="error">
                        <li th:each="error : ${errors.getFieldErrors('composer')}"
                            th:text="${error.getDefaultMessage()}"></li>
                    </ul>
                </div>
            </th:block>
        </div>
        <div class="field">
            <div>
                <label for="producer">Режисёр:
                    <input type="text" name="producer" id="producer" th:value="${movie.producer}">
                </label>
            </div>
            <th:block th:if="${errors}">
                <div th:if="${errors.hasFieldErrors('producer')}">
                    <ul class="error">
                        <li th:each="error : ${errors.getFieldErrors('producer')}"
                            th:text="${error.getDefaultMessage()}"></li>
                    </ul>
                </div>
            </th:block>
        </div>
        <div class="field">
            <div>
                <label for="actors">Актёры:
                    <textarea name="actors" id="actors" rows="3" cols="60"
                              th:text="${movie.actors}"></textarea>
                </label>
            </div>
            <th:block th:if="${errors}">
                <div th:if="${errors.hasFieldErrors('actors')}">
                    <ul class="error">
                        <li th:each="error : ${errors.getFieldErrors('actors')}"
                            th:text="${error.getDefaultMessage()}"></li>
                    </ul>
                </div>
            </th:block>
        </div>
        <div class="field">
            <div>
                <label for="description">Описание:
                    <textarea name="description" id="description" rows="10" cols="60"
                              th:text="${movie.description}"></textarea>
                </label>
            </div>
            <th:block th:if="${errors}">
                <div th:if="${errors.hasFieldErrors('description')}">
                    <ul class="error">
                        <li th:each="error : ${errors.getFieldErrors('description')}"
                            th:text="${error.getDefaultMessage()}"></li>
                    </ul>
                </div>
            </th:block>
        </div>
        <div id="posterInfo" class="field">
            <div>
                <label for="poster">Постер:
                    <input type="file" accept="image/*" name="poster" id="poster" onchange="checkFileSize(this)">
                </label>
            </div>
            <th:block th:if="${errors}">
                <div id="posterErrors">
                    <ul id="errorList" class="error">
                        <li th:if="${!errors.hasFieldErrors('poster')}">Пожалуйста, загрузите изображение заново!</li>
                        <th:block th:if="${errors.hasFieldErrors('poster')}">
                            <li th:each="error : ${errors.getFieldErrors('poster')}"
                                th:text="${error.getDefaultMessage()}"></li>
                        </th:block>
                    </ul>
                </div>
            </th:block>
        </div>

        <button type="submit">Добавить фильм</button>
    </form>
</div>

<script>
    function checkFileSize(posterInput) {
        if (posterInput.files[0].size > 5242880) {
            if (document.getElementById('posterErrors') != null) {
                let errorList = document.getElementById('errorList');
                errorList.innerHTML = '';
                errorList.innerHTML += '<li>Размер изображения не должен превышать 5МБ!</li>';
                posterInput.value = '';
            } else {
                document.getElementById('posterInfo').innerHTML += '<div id="posterErrors">\n' +
                                                                        '<ul id="errorList" class="error">' +
                                                                            '<li>Размер изображения не должен превышать 5МБ!</li>' +
                                                                        '</ul>' +
                                                                    '</div>';
                posterInput.value = '';
            }
        }
    }
</script>
</body>
</html>